<!DOCTYPE html><html lang="zh-TW"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="oxxo.studio">
  <meta name="copyright" content="oxxo.studio">
  <meta name="keywords" content="oxxo,D3,SVG,CSS,jQuery,網頁前端,UI,UX,視覺設計,網頁設計,設計,介面設計,創意,創作,攝影,web,前端技術,web design,design,web,ui design,front-end,css3,photoshop,illustrator">

  <title>簡單打造站內搜尋、標題搜尋 - OXXO.STUDIO</title>

  <meta name="description" content="自己個 blog 從五月正式上線至今，一直都缺了一個「站內搜尋」的功能，總算在這陣子找了空檔，把這個功能補上，同時在 list 頁面新增了 filter 以及標題搜尋的功能，每一篇文章的最下方也新增的上一頁下一頁的功能，最後順便把一些長期累積的小 bug 給修掉，在底層動的工程頗精彩呀。">
  <meta itemprop="description" content="自己個 blog 從五月正式上線至今，一直都缺了一個「站內搜尋」的功能，總算在這陣子找了空檔，把這個功能補上，同時在 list 頁面新增了 filter 以及標題搜尋的功能，每一篇文章的最下方也新增的上一頁下一頁的功能，最後順便把一些長期累積的小 bug 給修掉，在底層動的工程頗精彩呀。">
  <meta itemprop="image" content="http://www.oxxostudio.tw/img/articles/201412/site-search.jpg">
  <meta property="og:description" content="自己個 blog 從五月正式上線至今，一直都缺了一個「站內搜尋」的功能，總算在這陣子找了空檔，把這個功能補上，同時在 list 頁面新增了 filter 以及標題搜尋的功能，每一篇文章的最下方也新增的上一頁下一頁的功能，最後順便把一些長期累積的小 bug 給修掉，在底層動的工程頗精彩呀。">
  <meta property="og:title" content="簡單打造站內搜尋、標題搜尋">
  <meta property="og:url" content="http://www.oxxostudio.tw/articles/201412/site-search.html">
  <meta property="og:image" content="http://www.oxxostudio.tw/img/articles/201412/site-search.jpg">
  <script src="/js/lib/run_prettify.js"></script>
  <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8629612872829139",
    enable_page_level_ads: true
  });
  </script>
  <link href="/css/article.css" rel="stylesheet">
  <link href="/css/lib/theme.min.css" rel="stylesheet">
</head>

<body>
  <div id="header">
    <div id="top-menu">
      <ul class="top-menu-left">
        <li class="list" title="文章列表"><i></i><a href="/list.html">ARCHIVE</a></li>
        <li class="about" title="關於我"><i></i><a href="/articles/201405/about-me.html">ABOUT</a></li>
        <li class="contact" title="聯絡方式"><i></i><a href="/articles/201405/contact.html">CONTACT</a></li>
      </ul>
      <a href="/rss.xml" title="RSS" target="_blank">
        <div class="rss"><i></i></div>
      </a>
      <div class="search" title="站內搜尋">
        <div id="cse-search-form" style="width: 100%;">
          <gcse:searchbox-only></gcse:searchbox-only>
        </div>
      </div>
    </div>
    <div id="banner">
      <a href="/">
        <i class="bubble"></i>
        <i class="hihi"></i>
        <img src="/img/layout/banner.png">
        <h2>Design thinking is everywhere</h2>
      </a>
    </div>
    <div id="main-menu">
      <div class="mobile-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <ul>
        <li class="tag-all"><i></i>ALL</li>
        <li class="tag-creative"><i></i>Creative</li>
        <li class="tag-ui"><i></i>UI &amp; UX</li>
        <li class="tag-photo"><i></i>PHOTO</li>
        <li class="tag-css"><i></i>CSS</li>
        <li class="tag-web"><i></i>WEB TECH</li>
        <li class="tag-share"><i></i>Share</li>
        <li class="tag-others"><i></i>OTHERS</li>
      </ul>
    </div>
    <div class="body-line"></div>
  </div>

  <main>
    <article>
      <i class="tag"></i>

<h1>簡單打造站內搜尋、標題搜尋</h1>
<p>自己個 blog 從五月正式上線至今，一直都缺了一個「站內搜尋」的功能，總算在這陣子找了空檔，把這個功能補上，同時在 list 頁面新增了 filter 以及標題搜尋的功能，每一篇文章的最下方也新增的上一頁下一頁的功能，最後順便把一些長期累積的小 bug 給修掉，在底層動的工程頗精彩呀。</p>
<p>這篇文章來分享一下自己部落格使用的兩種站內搜尋方式，第一種是利用 google 的「<strong>自訂搜尋</strong>」，就可以做出利用 google 進行全站搜尋的超強大功能，第二種則是<strong>單純使用一行 CSS 和一點點的 jQuery</strong>，就可以實現純前端的單頁內容搜尋，我也將這種方法應用在 <a href="http://www.oxxostudio.tw/list.html" target="_blank">list 頁面</a> 進行標題的快速查找，兩種搜尋功能互相搭配，部落格的功能總算是完備了。</p>
<p><br></p>
<p>###第一種 google 的自訂搜尋
要使用自訂搜尋，就要先登入「<strong><a href="https://www.google.com/cse/?hl=zh-TW" target="_blank">自訂搜尋引擎</a></strong>」。</p>
<p><img src="/img/articles/201412/20141201_1_02.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
登入之後，就把自己的網站或部落格網只填入「要搜尋的網站」，然後給個名稱即可。</p>
<p><img src="/img/articles/201412/20141201_1_03.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
以我的 blog 來說，完成後就會長這樣：</p>
<p><img src="/img/articles/201412/20141201_1_04.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
進入之後會先看到這個畫面，第一頁其實沒有甚麼特別 ( 進階功能沒有摸索不了解 )，主要就是一些這個搜尋引擎的基本設定。</p>
<p><img src="/img/articles/201412/20141201_1_05.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
真正的重點是第二頁「外觀和風格」，這一頁決定了搜尋引擎的長相，以及搜尋結果要出現的位置，google 總共提供了七種方式讓我們選擇，好幾年前我的 blog 是採用「google 代管」的方式，這個方式其實很簡單，就是搜尋結果會像 google 搜尋一樣獨立一頁出來，就不需要考慮樣式和結果頁面的呈現，而我現在的 blog，是使用「2 頁」的作法。</p>
<p><img src="/img/articles/201412/20141201_1_06.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
選擇好了之後，點選右下角「儲存並取得程式碼」，就可以開始進行我們搜尋引擎的製作，因為我選擇的是「2頁」，所以第一步要先點選上方「搜尋結果詳細資料」來進行設定。</p>
<p><img src="/img/articles/201412/20141201_1_07.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
點選後，第一個欄位是搜尋頁面的位置，第二個欄位是搜尋時在網址列的參數代碼，預設是 q，而我這邊設為 s。</p>
<p><img src="/img/articles/201412/20141201_1_08.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
一開始 google 所提供的是第三版，剛剛上面提到搜尋頁面的位置，影響比較大的也就是這一版，不過這版上去之後，雖然搜尋的功能是正常，但在開發者工具裏頭都會報錯 (<code>Failed to load resource - http://www.google.com/uds/?file=ads&amp;v=3&amp;packages=search&amp;async=2</code>)，查了很久都找不到解決方式，為了避免報錯不知道會產生甚麼問題，所以就捨棄這一個版本，點選下方「<strong>取得 V1 程式碼</strong>」就可以取得 V1 的程式碼，從程式碼中可以發現剛剛設定的參數都在裏頭，而你也可以點選下一步，就可以看到搜尋結果頁面的程式碼。</p>
<p><img src="/img/articles/201412/20141201_1_09.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
了解之後，回頭看一下上面的程式，<code>&lt;div id='cse-search-form' style='width: 100%;'&gt;Loading&lt;/div&gt;</code>這一段其實就是搜尋框的位置，我放在右上角的搜尋框，loading 是預設的顯示文字，loading 完成後就會自動消失，我自己是不喜歡，所以我就把 loading 移除了，至於 js 我放在整個頁面的最下方，避免有甚麼問題的時候，也只有搜尋死掉而已。</p>
<p><img src="/img/articles/201412/20141201_1_10.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
不過剛放上搜尋框的時候一定會被他的樣式嚇到，因為就是一個很醜的<code>text-input</code>加上一顆<code>button</code>，打開開發者工具可以清楚地發現，網頁被內嵌了一大堆 style，而搜尋框也是內含一脫拉庫的 HTML。</p>
<p><img src="/img/articles/201412/20141201_1_11.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
這時候就必須要利用 <a href="http://www.oxxostudio.tw/articles/201405/css-specificity.html" target="_blank">CSS 的權重</a> 來和這些 style 硬碰硬，就可以把這些 style 強壓換成自己的 style，下圖是我的 SCSS 長相，因為 google 加入的 style 在我的 style 後面，導致我的 style 怎麼寫都會被蓋掉 ( 當然可以用 id 打頭覆蓋，但我的 HTML 沒有 id，就無法這麼做 )，所以這裡我用了不少<code>!important</code>來進行覆蓋的作業。(<code>!important</code>很邪惡，要小心使用。 )</p>
<p><img src="/img/articles/201412/20141201_1_12.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
同樣的，取得搜尋結果程式碼後，程式碼的<code>&lt;div id='cse' style='width: 100%;'&gt;Loading&lt;/div&gt;</code> 放在搜尋結果頁面要顯示結果的位置，看看搜尋結果畫面的長相，也是由一大堆被 google 塞進去的 DOM 所組成。</p>
<p><img src="/img/articles/201412/20141201_1_13.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
因此這裡同樣要強迫把 style 給覆蓋掉，這裡同樣使用了<code>!important</code>來強制覆蓋。( 其實免費版的有廣告，還有一些有的沒有的欄位，都可以用這種方式來覆蓋使其消失 )</p>
<p><img src="/img/articles/201412/20141201_1_14.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
完成後，恭喜恭喜，整個網站的站內搜尋總算是大功告成啦！其實要使用 google 的站內搜尋是很簡單的，程式碼貼上去基本上就都可以搜尋嘗鮮，但真正麻煩的還是在調整 UI 的細節，要如何才能讓搜尋框、按鈕和搜尋結果，與自己的網站無縫接軌搭配，才是真正耗費時間的地方。</p>
<p><br></p>
<p>###第二種標題搜尋
至於我的 blog 內的第二種搜尋方式「標題搜尋」，就不是用像 google 的這種高級方式，而是單純的利用了 CSS 裏頭的<code>:not</code>，<code>:not</code>顧名思義就是「<strong>沒有的</strong>就會怎樣怎樣...」，原理很簡單，當輸入文字的時候，同時寫入 CSS，藉由 CSS 與 DOM 之間的連動，就可以輕鬆做出及時篩選的功能。( 參考 <a href="http://www.oxxostudio.tw/list.html" target="_blank">所有文章列表</a> )</p>
<p>要如何實現呢？首先我在我的 blog 原始碼裡頭放了一段空白的 style，並給予一個 class 命名，如此一來，我就可以用 jquery 在裡面寫東西。 </p>
<p><img src="/img/articles/201412/20141201_1_15.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
第二步，我在清單裡頭都加入了一個<code>data-title</code>的 HTML5 才有的 data attribute，其實不一定要叫 title，主要是以<code>data-</code>打頭的都是 HTML5 特有的 data attribute，有了這個屬性，我們就可以用 CSS 來獲取。</p>
<pre class="prettyprint"><code>&lt;li class="tag-web" data-title="svg d3.js - 區域 ( area )"&gt;
</code></pre><p><img src="/img/articles/201412/20141201_1_16.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>
<p><br>
再來就是了解一下剛剛的那個 style 裡面該放些甚麼，裡面是要動態寫入寫入下方的 CSS，如此一來，data-title 裡面只要有吻合的字串，就會顯示，沒有就會被加入<code>display:none</code>的屬性。</p>
<pre class="prettyprint"><code>#container .content li:not([data-title*="字串"]) {display: none;}
</code></pre><p><br>
最後就是寫 js 了，一開始定義按下、貼上或改變時就會觸發的事件，為了避免有英文大小寫的問題，一開始就先使用<code>toLowerCase()</code>讓輸入的值都轉為小寫，並且當沒有數值的時候，清空 style，避免清空的時候無法還原所有的清單。</p>
<pre class="prettyprint"><code>$search.on('change paste keyup',function(){
    var value = $(this).val().toLowerCase();
    if(!value){
      $('.list-search-style').html('');
    }
    else{
      _searchStart(value);
    }
  function _searchStart(v){
    $('.list-search-style').html(
      '#container .content li:not([data-title*="' + v + '"]) {display: none;}'
    );
  }
}
</code></pre><p><br>
就這樣，很簡單的就做出一個及時搜尋的功能，不過除了上面寫的，我還多寫了很多行，畢竟在我的 blog 裏頭，還牽扯到和 filter 標籤的互動，不過理解原理後，就可以做出很多有趣的應用囉！( 參考 <a href="http://www.oxxostudio.tw/list.html" target="_blank">所有文章列表</a> )</p>
<p><img src="/img/articles/201412/20141201_1_17.jpg" alt="簡單打造站內搜尋、標題搜尋"></p>


      <div class="social-icon">
        <i class="icon-home"><i></i><span>Back Home</span></i>
        <i class="icon-list"><i></i><span>Article List</span></i>
        <i class="icon-facebook"><i></i><span>Share on Facebook</span></i>
        <i class="icon-google"><i></i><span>Share on Google+</span></i>
        <i class="icon-twitter"><i></i><span>Share on Twitter</span></i>
        <i class="goto-top"><i></i><span>Back to Top</span></i>
      </div>
      <a class="arrow-left">
        <i></i>
      </a>
      <a class="arrow-right">
        <i></i>
      </a>

    </article>
  </main>
  <div id="other-articles">
    <div class="previous-next previous-article">
      前一篇文章：
      <br>
      <h4></h4>
    </div>
    <div class="previous-next next-article">
      下一篇文章：
      <br>
      <h4></h4>
    </div>
    <h3>您可以閱讀其他相關文章，或瀏覽 <a href="/list.html">所有文章</a></h3>
  </div>
  <div id="google-adsense">
  <!-- oxxo.studio AD -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8629612872829139" data-ad-slot="5895423206" data-ad-format="auto"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  </div>
  <div id="disqus">
    <div id="disqus_thread"></div>
  </div>

  <div id="footer">
    <div class="footer-line"></div>
    <div class="footer-link">
      <ul>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </div>
    <div class="license">Copyright 2017 | All Rights Reserved. Designed by <a href="/">OXXO.STUDIO</a></div>
  </div>

  <script src="/js/lib/jquery.min.js"></script>
  <script src="/js/lib/disqus.js"></script>
  <script src="/js/layout.js"></script>
  <script src="/js/articles.js"></script>
  <script src="https://www.google.com/jsapi"></script>
  <script>
  (function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-2708968-3', 'auto');
  ga('send', 'pageview');
  </script>




</body></html>