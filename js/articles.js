$(function(){function t(){o.scroll(function(){o.scrollTop()>150?$(".social-icon, .arrow").addClass("show"):$(".social-icon, .arrow").removeClass("show")})}function e(){l.each(function(){var t=$(this);if(t.attr("data-src")){var e=$(this).attr("data-src");t.offset().top-o.height()<0?(t.attr("src",e),t.removeAttr("data-src")):o.scrollTop()>0&&(t.attr("src",e),t.removeAttr("data-src"))}})}var i,a,n,o=$(window),c=($(document),$("article"),location.href),l=$(".lazy"),r="/articles/"+(a=c.split("/"))[a.length-2]+"/";a.forEach(function(t){if(-1!=t.indexOf(".html"))if(-1!=t.indexOf("?")){e=t.split("?");n=r+e[0]}else if(-1!=t.indexOf("#")){var e=t.split("#");n=r+e[0]}else n=r+t}),-1==c.indexOf(".html")&&(window.location.href=c+".html"),$(".preview-img").unwrap("p"),function(t){$.getJSON("/json/pageList.json",function(e){e.forEach(function(e){e.site==t&&($(".tag").addClass(e.tag),$("h1").attr("data-date",e.date),tagName=e.tag)});var a,o=[],c=0;e.forEach(function(t){t.tag==tagName&&(o[c]=t,c+=1),-1!=t.site.indexOf(n)&&(a=e.indexOf(t))});var r,s=[];if(c<=5)for(i=0;i<c;i++)r=o[i].img?o[i].img:"/img"+o[i].site.replace(".html","-s.jpg"),$("#other-articles").append('<a href="'+o[i].site+'"><div><img class="lazy" data-src="'+r+'"><h4>'+o[i].title+"</h4></div></a>"),l=$(".lazy");else for(i=c;i>=c-4;i--){var h=Math.floor(i*Math.random(i));s[i-5]=o.splice(h,1)[0],r=s[i-5].img?s[i-5].img:"/img"+s[i-5].site.replace(".html","-s.jpg"),$("#other-articles").append('<a href="'+s[i-5].site+'"><div><img class="lazy" data-src="'+r+'"><h4>'+s[i-5].title+"</h4></div></a>"),l=$(".lazy")}0==a?($(".next-article h4").html("沒有下一篇文章了呦~"),$(".previous-article h4").html("<a href="+e[a+1].site+">"+e[a+1].title+"</a>"),$(".arrow-left").attr("href",e[a+1].site).attr("title",e[a+1].title).addClass("hasArticle")):a==e.length-1?($(".previous-article h4").html("沒有前一篇文章了呦~"),$(".next-article h4").html("<a href="+e[a-1].site+">"+e[a-1].title+"</a>"),$(".arrow-right").attr("href",e[a-1].site).attr("title",e[a-1].title).addClass("hasArticle")):($(".previous-article h4").html("<a href="+e[a+1].site+">"+e[a+1].title+"</a>"),$(".arrow-left").attr("href",e[a+1].site).attr("title",e[a+1].title).addClass("hasArticle"),$(".next-article h4").html("<a href="+e[a-1].site+">"+e[a-1].title+"</a>"),$(".arrow-right").attr("href",e[a-1].site).attr("title",e[a-1].title).addClass("hasArticle"))}),e(),o.scroll(e)}(n),t(),function(t){$(".icon-home").on("click",function(){window.open("/index.html","_self"),ga("send","event","iconMenu","click","home")}),$(".icon-list").on("click",function(){window.open("/list.html","_self"),ga("send","event","iconMenu","click","list")}),$(".icon-facebook").on("click",function(){window.open("http://www.facebook.com/share.php?u="+t,"_blank"),ga("send","event","iconMenu","click","facebook")}),$(".icon-google").on("click",function(){window.open("https://plus.google.com/share?url="+t,"_blank"),ga("send","event","iconMenu","click","google")}),$(".icon-twitter").on("click",function(){window.open("http://twitter.com/home/?status="+t,"_blank"),ga("send","event","iconMenu","click","twitter")}),$(".goto-top").on("click",function(){$("html,body").animate({scrollTop:"0"},750),ga("send","event","iconMenu","click","top")}),$(".previous-next").on("click",function(){ga("send","event","moreLink","click","preAndNext")}),$(".content a").on("click",function(){ga("send","event","contentLink","click",$(this).attr("href"))}),$(".arrow").on("click",function(){ga("send","event","moreLink","click","arrowLeftRight")})}(c),o.resize(t)});