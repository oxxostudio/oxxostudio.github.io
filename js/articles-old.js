$(function(){var t,e,i,a=$(window),o=$(document),n=($("article"),location.href),c=$(".lazy"),l=$(".closeBtn"),r=o.height()/2,s="/articles/"+(e=n.split("/"))[e.length-2]+"/";e.forEach(function(t){if(-1!=t.indexOf(".html"))if(-1!=t.indexOf("?")){var e=t.split("?");i=s+e[0]}else if(-1!=t.indexOf("#")){e=t.split("#");i=s+e[0]}else i=s+t});var h,d,f=$(".recommend ul");function m(){a.scroll(function(){a.scrollTop()>150?$(".social-icon, .arrow").addClass("show"):$(".social-icon, .arrow").removeClass("show"),a.scrollTop()>r?$(".recommend").addClass("show"):$(".recommend").removeClass("show")}),l.on("click",function(){$(".recommend").addClass("hide")})}function g(){c.each(function(){var t=$(this);if(t.attr("data-src")){var e=$(this).attr("data-src");t.offset().top-a.height()<0?(t.attr("src",e),t.removeAttr("data-src")):a.scrollTop()>0&&(t.attr("src",e),t.removeAttr("data-src"))}})}-1==n.indexOf(".html")&&(window.location.href=n+".html"),$(".preview-img").unwrap("p"),h=i,$.getJSON("/json/pageList.json",function(e){e.forEach(function(t,e){t.site==h&&($(".tag").addClass(t.tag),$("h1").attr("data-date",t.date),tagName=t.tag),e<3&&f.append('<li><a href="'+t.site+'?utm_source=recommend">'+t.title+"</a></li>")});var a,o=[],n=0;e.forEach(function(t){t.tag==tagName&&(o[n]=t,n+=1),-1!=t.site.indexOf(i)&&(a=e.indexOf(t))});var l,r=[];if(n<=5)for(t=0;t<n;t++)l=o[t].img?o[t].img:"/img"+o[t].site.replace(".html","-s.jpg"),$("#other-articles").append('<a href="'+o[t].site+'"><div><img class="lazy" data-src="'+l+'"><h4>'+o[t].title+"</h4></div></a>"),c=$(".lazy");else for(t=n;t>=n-4;t--){var s=Math.floor(t*Math.random(t));r[t-5]=o.splice(s,1)[0],l=r[t-5].img?r[t-5].img:"/img"+r[t-5].site.replace(".html","-s.jpg"),$("#other-articles").append('<a href="'+r[t-5].site+'"><div><img class="lazy" data-src="'+l+'"><h4>'+r[t-5].title+"</h4></div></a>"),c=$(".lazy")}0==a?($(".next-article h4").html("沒有下一篇文章了呦~"),$(".previous-article h4").html("<a href="+e[a+1].site+">"+e[a+1].title+"</a>"),$(".arrow-left").attr("href",e[a+1].site).attr("title",e[a+1].title).addClass("hasArticle")):a==e.length-1?($(".previous-article h4").html("沒有前一篇文章了呦~"),$(".next-article h4").html("<a href="+e[a-1].site+">"+e[a-1].title+"</a>"),$(".arrow-right").attr("href",e[a-1].site).attr("title",e[a-1].title).addClass("hasArticle")):($(".previous-article h4").html("<a href="+e[a+1].site+">"+e[a+1].title+"</a>"),$(".arrow-left").attr("href",e[a+1].site).attr("title",e[a+1].title).addClass("hasArticle"),$(".next-article h4").html("<a href="+e[a-1].site+">"+e[a-1].title+"</a>"),$(".arrow-right").attr("href",e[a-1].site).attr("title",e[a-1].title).addClass("hasArticle"))}),g(),a.scroll(g),m(),d=n,$(".icon-home").on("click",function(){window.open("/index.html","_self"),ga("send","event","iconMenu","click","home")}),$(".icon-list").on("click",function(){window.open("/list.html","_self"),ga("send","event","iconMenu","click","list")}),$(".icon-facebook").on("click",function(){window.open("http://www.facebook.com/share.php?u="+d,"_blank"),ga("send","event","iconMenu","click","facebook")}),$(".icon-google").on("click",function(){window.open("https://plus.google.com/share?url="+d,"_blank"),ga("send","event","iconMenu","click","google")}),$(".icon-twitter").on("click",function(){window.open("http://twitter.com/home/?status="+d,"_blank"),ga("send","event","iconMenu","click","twitter")}),$(".goto-top").on("click",function(){$("html,body").animate({scrollTop:"0"},750),ga("send","event","iconMenu","click","top")}),$(".previous-next").on("click",function(){ga("send","event","moreLink","click","preAndNext")}),$(".content a").on("click",function(){ga("send","event","contentLink","click",$(this).attr("href"))}),$(".arrow").on("click",function(){ga("send","event","moreLink","click","arrowLeftRight")}),a.resize(m)});